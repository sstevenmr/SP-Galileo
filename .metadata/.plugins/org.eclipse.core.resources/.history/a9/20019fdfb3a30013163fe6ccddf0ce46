package com.sp.mall.fragments;


import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.database.Cursor;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.drawable.BitmapDrawable;
import android.graphics.drawable.Drawable;
import android.net.Uri;
import android.os.Bundle;
import android.provider.MediaStore;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.ListView;

import com.sp.mall.R;
import com.sp.mall.data.ImageAdapter;

public class ComunityFragment extends Fragment { 
	private static final int LOAD_IMAGE =1;
	private static final int CAMERA = 2;
	ImageButton btnFromCamera;
	ImageAdapter adapter=null;
	View view;
	PhotoDialogFragment dialog;
	public View onCreateView(LayoutInflater inflater, ViewGroup container, 
	        Bundle savedInstanceState) { 
	        view = inflater.inflate(R.layout.comunity_fragment,container, false);
	        ListView list = (ListView) view.findViewById(R.id.listViewP);
	        adapter = new ImageAdapter(getActivity());
	        list.setAdapter(adapter);
	        btnFromCamera = (ImageButton) view.findViewById(R.id.btnFromCamera);
	        dialog = new PhotoDialogFragment();
	        btnFromCamera.setOnClickListener(new OnClickListener() {
				@Override
				public void onClick(View v) {
					AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());
					builder.setTitle("Menu");
					ArrayAdapter<String> adaptador = new ArrayAdapter<String>(getActivity(),android.R.layout.simple_list_item_1);
					adaptador.add("Tomar Fotografia");
					adaptador.add("Desde la galeria");
					builder.setAdapter(adaptador, new DialogInterface.OnClickListener() {
						
						@Override
						public void onClick(DialogInterface dialog, int which) {
							int code = 0;
							Intent intent = null;
							if(which==0){
								 intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
								 code = CAMERA;
							}else if(which==1){
								intent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);
								code = LOAD_IMAGE;
							}
								startActivityForResult(intent, code);
						}
					});
				builder.create().show();
				}
			});
	        return view;
	}
	
	@Override
	public void onActivityResult(int requestCode, int resultCode, Intent data) {
		super.onActivityResult(requestCode, resultCode, data);
		if(requestCode == LOAD_IMAGE  && resultCode == getActivity().RESULT_OK && data != null){
			Uri selectedImage = data.getData();
			String[] filePathColumn = {MediaStore.Images.Media.DATA};
			Cursor cursor =getActivity().getContentResolver().query(selectedImage,filePathColumn,null,null,null);
			if(cursor.moveToFirst()){
				int columnIndex = cursor.getColumnIndex(filePathColumn[0]);
				String picturePath = cursor.getString(columnIndex);
				cursor.close();
			
				Bitmap bit = BitmapFactory.decodeFile(picturePath);
				Bitmap b = BitmapFactory.decodeResource(getResources(), bit.hashCode());
				notBuilder.setLargeIcon(b);
				//ImageView img = (ImageView)view.findViewById(R.id.imageView1);	
				//img.setImageBitmap(bit);
				Drawable image = new BitmapDrawable(this.getResources(),bit);
				adapter.setArrays(,"hola");
				
			}
		}
	}
		
}

