package com.sp.mall.fragments;


import java.util.ArrayList;

import android.content.Intent;
import android.database.Cursor;
import android.graphics.BitmapFactory;
import android.net.Uri;
import android.os.Bundle;
import android.provider.MediaStore;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.ListView;

import com.sp.mall.R;
import com.sp.mall.data.ImageAdapter;

public class ComunityFragment extends Fragment {
	View view;
	private static final int LOAD_IMAGE =1;
	private static final int CAMERA = 2;
	ImageButton btnFromCamera;
	ImageAdapter adapter=null;
	public View onCreateView(LayoutInflater inflater, ViewGroup container, 
	        Bundle savedInstanceState) { 
	        view = inflater.inflate(R.layout.comunity_fragment,container, false);
	        ListView list = (ListView) view.findViewById(R.id.listViewP);
	        adapter = new ImageAdapter(getActivity());
	        list.setAdapter(adapter);
	        btnFromCamera = (ImageButton) view.findViewById(R.id.btnFromCamera);
	        btnFromCamera.setOnClickListener(new OnClickListener() {
				
				@Override
				public void onClick(View v) {
					new PhotoDialogFragment().show(getFragmentManager(), "");
					
				}
			});
	        return view;
	}
	
	@Override
	public void onActivityResult(int requestCode, int resultCode, Intent data) {
		// TODO Auto-generated method stub
		super.onActivityResult(requestCode, resultCode, data);
		if(requestCode == LOAD_IMAGE && resultCode == getActivity().RESULT_OK && data != null){
			System.out.println("holaaaaaaaaaaaaaaaaaaaa");
			Uri selectedImage = data.getData();
			String[] filePathColumn = {MediaStore.Images.Media.DATA};
			Cursor cursor =getActivity().getContentResolver().query(selectedImage,filePathColumn,null,null,null);
			if(cursor.moveToFirst()){
				int columnIndex = cursor.getColumnIndex(filePathColumn[0]);
				String picturePath = cursor.getString(columnIndex);
				cursor.close();
				ImageView img = (ImageView)view.findViewById(R.id.image);
				img.setImageBitmap(BitmapFactory.decodeFile(picturePath));
				adapter.arrayImage.add(R.id.image);
				adapter.arrayStringMall.add("Image");
			}
		}
	}
	 
}
